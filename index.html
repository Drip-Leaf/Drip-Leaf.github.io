<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
<!DOCTYPE html>

<html>
<body>
<script>
  function copy(x) 
  {
    return JSON.parse(JSON.stringify(x));
  }

  function get_uniform(min, max) 
  {
    return Math.min(min + Math.floor(Math.random() * (max - min)), max - 1);
  }

  var board_dimension = 3;
  function create_board()
  {
    var board = Array(board_dimension);
    for (var i = 0; i < board_dimension; i++)
    {
      board[i] = Array(board_dimension);
      for (var j = 0; j < board_dimension; j++)
        board[i][j] = 0;
    }

    return board;
  }

  function check_state(board, move)
  {
    var b;

    for (var i = 0; i < board_dimension; i++)
    {
      b = true;
      for (var j = 0; j < board_dimension; j++)
      {
        if (board[i][j] != move)
        {
          b = false;
          break;
        }
      }
      if (b)
        return true;
    }

    for (var j = 0; j < board_dimension; j++)
    {
      b = true
      for (var i = 0; i < board_dimension; i++)
      {
        if (board[i][j] != move)
        {
          b = false;
          break;
        }
      }
      if (b)
        return true;
    }

    b = true;
    for (var i = 0; i < board_dimension; i++)
    {
      if (board[i][i] != move)
      {
        b = false;
        break;
      }
    }
    if (b)
      return true

    b = true;
    for (var i = 0; i < board_dimension; i++) 
    {
      if (board[i][board_dimension - i - 1] != move) 
      {
        b = false;
        break;
      }
    }
    if (b)
      return true;

    return false;
  }

  var current_state = create_board();
  var who_won = 0;

  function new_game()
  {
    current_state = create_board();
    who_won = 0; 
    
    for (var i = 0; i < board_dimension; i++)
      for (var j = 0; j < board_dimension; j++)
        document.getElementById(i.toString() + j.toString()).innerHTML = ".";

    document.getElementById("Win").innerHTML = "No one has won yet...";
  }

  var dictionary = Array(3);
  dictionary[1] = {};
  dictionary[2] = {};

  function Play(board, move)
  {
    if (board in dictionary[move])
      return dictionary[move][board].who_move;

    var win = false;
    var win_moves = [];
    var draw = false;
    var draw_moves = [];
    var loose = false;
    var loose_moves = [];
    for (var i = 0; i < board_dimension; i++)
    {
      for (var j = 0; j < board_dimension; j++)
      {
        if (board[i][j] != 0)
          continue;

        var board_move = copy(board);

        board_move[i][j] = move;

        if (check_state(board_move, move))
        {
          win = true;
          win_moves.push({i, j});
          continue;
        }

        var state_move = Play(board_move, 3 - move);

        if (state_move == move)
        {
          win = true;
          win_moves.push({i: i, j: j});
          continue;
        }

        if (state_move == 0)
        {
          draw = true;
          draw_moves.push({i: i, j: j});
          continue;
        }

        loose = true;
        loose_moves.push({i: i, j: j});
      }
    }

    if (win)
      dictionary[move][board] = {who_move: move, moves: win_moves};
    else if (draw)
      dictionary[move][board] = {who_move: 0, moves: draw_moves};
    else if (loose)
      dictionary[move][board] = {who_move: 3 - move, moves: loose_moves};

    if (win)
      return move;
    
    if (draw)
      return 0;
    
    if (loose)
      return 3 - move;
    
    return 0;
  }

  var who_move = 1;
  function make_move(x, y)
  {
    if (who_won != 0)
      return false;

    if (current_state[x][y] != 0)
      return false;

    current_state[x][y] = who_move;

    var text;
    if (who_move == 1)
      text = "X";
    else
      text = "O";

    document.getElementById(x.toString() + y.toString()).innerHTML = text;

    if (check_state(current_state, who_move))
    {
      who_won = who_move;

      document.getElementById("Win").innerHTML = text + " win!";

      return true;
    }

    who_move = 3 - who_move;

    return true;
  }

  function make_computer_move()
  {
    if (who_won != 0)
      return;

    Play(current_state, who_move);

    var computer_move = dictionary[who_move][current_state];

    if (!computer_move)
      return;

    var number_of_moves = computer_move.moves.length;

    if (0 < number_of_moves)
    {
      var choose_move = get_uniform(0, number_of_moves);
      var chosen_computer_move = computer_move.moves[choose_move];
      current_state[chosen_computer_move.i][chosen_computer_move.j] = who_move;

      var text;
      if (who_move == 1)
        text = "X";
      else
        text = "O";

      document.getElementById(chosen_computer_move.i.toString() + chosen_computer_move.j.toString()).innerHTML = text;

      if (check_state(current_state, who_move)) 
      {
        who_won = who_move;

        document.getElementById("Win").innerHTML = text + " win!";
      }

      who_move = 3 - who_move;
    }
  }

  function make_move_and_make_computer_move(x, y)
  {
    if (make_move(x, y))
      make_computer_move();
  }
</script>
  <h1 style="font-variant: small-caps; text-align: center; color:#3097f1;">Tic Tac Toe</h1>
  <div align="center";>
    <button style = "width:50px; height:50px; background-color:rgb(71, 104, 255);color:#a6bbff;"id="00" onclick="make_move_and_make_computer_move(0, 0)">.</button>
    <button style = "width:50px; height:50px; background-color:rgb(71, 104, 255);color:#a6bbff;"id="01" onclick="make_move_and_make_computer_move(0, 1)">.</button>
    <button style = "width:50px; height:50px; background-color:rgb(71, 104, 255);color:#a6bbff;"id="02" onclick="make_move_and_make_computer_move(0, 2)">.</button>
    <!-- <button id="03" onclick="make_move_and_make_computer_move(0, 3)">- </button> -->
    <br>
  </div>
  <div align="center";>
    <button style = "width:50px; height:50px; background-color:rgb(71, 104, 255);color:#a6bbff;"id="10" onclick="make_move_and_make_computer_move(1, 0)">.</button>
    <button style = "width:50px; height:50px; background-color:rgb(71, 104, 255);color:#a6bbff;"id="11" onclick="make_move_and_make_computer_move(1, 1)">.</button>
    <button style = "width:50px; height:50px; background-color:rgb(71, 104, 255);color:#a6bbff;"id="12" onclick="make_move_and_make_computer_move(1, 2)">.</button>
    <!-- <button id="13" onclick="make_move_and_make_computer_move(1, 3)">- </button> -->
    <br>
  </div>
  <div align="center";>
    <button style = "width:50px; height:50px; background-color:rgb(71, 104, 255);color:#a6bbff;"id="20" onclick="make_move_and_make_computer_move(2, 0)">.</button>
    <button style = "width:50px; height:50px; background-color:rgb(71, 104, 255);color:#a6bbff;"id="21" onclick="make_move_and_make_computer_move(2, 1)">.</button>
    <button style = "width:50px; height:50px; background-color:rgb(71, 104, 255);color:#a6bbff;"id="22" onclick="make_move_and_make_computer_move(2, 2)">.</button>
    <!-- <button id="23" onclick="make_move_and_make_computer_move(2, 3)">- </button> -->
  </div>
  <!-- <div>
    <button id="30" onclick="make_move_and_make_computer_move(3, 0)">- </button>
    <button id="31" onclick="make_move_and_make_computer_move(3, 1)">- </button>
    <button id="32" onclick="make_move_and_make_computer_move(3, 2)">- </button>
    <button id="33" onclick="make_move_and_make_computer_move(3, 3)">- </button>
  </div> -->
  <br>
  <div align="center";>
    <button style="background-color:rgb(46, 85, 255);color:#a6bbff;"id="Play" onclick="make_computer_move()">Computer move</button>
    <button style="background-color:rgb(46, 85, 255);color:#a6bbff;"id="New game" onclick="new_game()">New Game</button>
  </div>
  <p style = "font-variant:small-caps; text-align: center; color:rgb(135, 135, 228);"id="Win">No one has won yet...</p>
</body>
</html>
